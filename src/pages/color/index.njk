{% extends "case.njk" %}
{% set title = "Algorithmic Palettes" %}
{% set slug = "appsmith" %}
{% set description = "Magically accessible and harmonious color palettes for UI made from a single* input" %}
{% block colors %}
<style type='text/css'>
    :root {
        --bg: #f2f2f2;
        --fg: #0c2e44;
        --radius-base: 0.25em;
    }
    .case-grid figure.demo {
        flex-direction: row;
    }
    .demo * {
        font-family: sans-serif;
    }
    .demo .slice {
        max-width: 50%;
        display: flex;
        justify-content: center;
        padding: var(--space-3xl) var(--space-l);
    }
    .slice.light {
        background-color: var(--color-light-bg);
    }
    .slice.dark {
        background-color: var(--color-dark-bg);
    }

    .slice button {
        max-width: 16ch;
        border: none;
        border-radius: round(var(--radius-base), 1px);
        padding: var(--space-3xs);
    }
    .slice.light button {
        background-color: var(--color-light-bgAccent);
    }
    .slice.light button:hover {
        background-color: var(--color-light-bgAccentHover);
    }
    .slice.light button:active {
        background-color: var(--color-light-bgAccentActive);
    }
    .slice.dark button {
        background-color: var(--color-dark-bgAccent);
    }
    .slice.dark button:hover {
        background-color: var(--color-dark-bgAccentHover);
    }
    .slice.dark button:active {
        background-color: var(--color-dark-bgAccentActive);
    }
</style>
{% endblock %}

{% block scripts %}
<script src='https://colorjs.io/dist/color.global.min.js'></script>
<script src='../main.js'></script>
<script>
    function appendCssRules(lightTheme, darkTheme) {
        const root = document.querySelector(':root');

        Object.keys(lightTheme).forEach(tokenKey => {
            const token = lightTheme[tokenKey];
            root.style.setProperty(`--color-light-${tokenKey}`, token);
        });

        Object.keys(darkTheme).forEach(tokenKey => {
            const token = darkTheme[tokenKey];
            root.style.setProperty(`--color-dark-${tokenKey}`, token);
        });
    }

    // Debounce function to delay updates
    function debounce(func, delay) {
        let debounceTimer;
        return function (...args) {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(() => func(...args), delay);
        };
    }

    function handleInput(event) {
        const inputValue = event.target.value;
        const lightTheme = new LightTheme(inputValue).getColors();
        const darkTheme = new DarkTheme(inputValue).getColors();
        appendCssRules(lightTheme, darkTheme);
    }

    // Run on initial page load
    window.addEventListener('DOMContentLoaded', () => {
        const defaultValue = '#0080ff';
        const inputElement = document.getElementById('myInput');
        inputElement.value = defaultValue;

        const lightTheme = new LightTheme(defaultValue).getColors();
        const darkTheme = new DarkTheme(defaultValue).getColors();
        appendCssRules(lightTheme, darkTheme);

        // Add input event listener with debounce
        inputElement.addEventListener('input', debounce(handleInput, 300));
    });
</script>
{% endblock %}

{% block content %}
<input type='text' id='myInput'>
<figure class='full demo'>
    <div class='slice light'>
        <button>Do the Thing</button>
    </div>
    <div class='slice dark'>
        <button>Do the Thing</button>
    </div>
</figure>
{% endblock %}
